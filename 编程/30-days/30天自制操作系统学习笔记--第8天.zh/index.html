<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>【30天自制操作系统】 鼠标 | 谭升的博客</title><meta name=keywords content><meta name=description content="Abstract: 《30天自制操作系统》鼠标显示
Keywords: 《30天自制操作系统》，Macbook，鼠标"><meta name=author content="谭升"><link rel=canonical href=https://go.face2ai.com/%E7%BC%96%E7%A8%8B/30-days/30%E5%A4%A9%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--%E7%AC%AC8%E5%A4%A9.zh/><link crossorigin=anonymous href=../../../assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=../../../assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://go.face2ai.com/logo.png><link rel=icon type=image/png sizes=16x16 href=https://go.face2ai.com/logo.png><link rel=icon type=image/png sizes=32x32 href=https://go.face2ai.com/logo.png><link rel=apple-touch-icon href=https://go.face2ai.com/logo.png><link rel=mask-icon href=https://go.face2ai.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-105335860-3","auto"),ga("send","pageview"))</script><meta property="og:title" content="【30天自制操作系统】 鼠标"><meta property="og:description" content="Abstract: 《30天自制操作系统》鼠标显示
Keywords: 《30天自制操作系统》，Macbook，鼠标"><meta property="og:type" content="article"><meta property="og:url" content="https://go.face2ai.com/%E7%BC%96%E7%A8%8B/30-days/30%E5%A4%A9%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--%E7%AC%AC8%E5%A4%A9.zh/"><meta property="article:section" content="编程"><meta name=twitter:card content="summary"><meta name=twitter:title content="【30天自制操作系统】 鼠标"><meta name=twitter:description content="Abstract: 《30天自制操作系统》鼠标显示
Keywords: 《30天自制操作系统》，Macbook，鼠标"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":3,"name":"【30天自制操作系统】 鼠标","item":"https://go.face2ai.com/%E7%BC%96%E7%A8%8B/30-days/30%E5%A4%A9%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--%E7%AC%AC8%E5%A4%A9.zh/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"【30天自制操作系统】 鼠标","name":"【30天自制操作系统】 鼠标","description":"Abstract: 《30天自制操作系统》鼠标显示 Keywords: 《30天自制操作系统》，Macbook，鼠标\n","keywords":[],"articleBody":"Abstract: 《30天自制操作系统》鼠标显示 Keywords: 《30天自制操作系统》，Macbook，鼠标\n啊哈，鼠标 今天看的有点纠结，因为竟然看困了，很少有这种情况，主要是有好多东西作者并没有做深入介绍，只是说这样是对的，至于为啥这样以后再说，这让我感觉很不爽。具体来说说。 首先，先解决了鼠标运动的问题，我感觉这个不是什么大问题，只是读取数据那需要点技巧，就是验证数据的有效性，以前用单片机发送串口数据时也用到过类似的做法，作者提出的是检查第一个字的低八位以及高两位，如果高两位是0，而低八位是8，那么数据没问题，但并不一定绝对没问题，比如发送的数据为 0x08 0x00 0x11下一组为0x08 0x08 0x01时也就是队列里面是0x08 0x00 0x11 0x08 0x08 0x01时如果红色字体丢失任意一组数据，其结果和下一组结果都是错误的，但发生的概率很小，我们也没必要要求硬件每发送一个数据都要加上校验位，那样冗余太大，也浪费资源，而且估计鼠标也不会总坏。。。 个人来讲，我不想将桌面作为系统开发的前期所应该做的（等我自己写的时候不会这么弄），一个黑漆漆的命令行而具有更强大的功能，我觉得更好，而且将桌面和系统剥离开，也就是linux那样，感觉更加自由。哈哈，这都是自己的想法，没有任何科学根据。接下来就到了让我纠结的地方了，就是作者解释了之前没解释的汇编代码：\n ; haribote-os boot asm ; TAB=4 BOTPAK\tEQU\t0x00280000\t; c语言编写部分的入口位置 DSKCAC\tEQU\t0x00100000\t; 启动区将要被复制到的地方 DSKCAC0\tEQU\t0x00008000\t; dskcaco启动区存储地址，其实里面没啥，知识为了预留，这也是之前纠结的地方 ; BOOT_INFO関係 CYLS\tEQU\t0x0ff0\t; LEDS\tEQU\t0x0ff1 VMODE\tEQU\t0x0ff2\t; SCRNX\tEQU\t0x0ff4\t; SCRNY\tEQU\t0x0ff6\t; VRAM\tEQU\t0x0ff8\t; ORG\t0xc200\t; ; 显示设置，中断号10H具体中断用法参照google MOV\tAL,0x13\t; MOV\tAH,0x00 INT\t0x10 MOV\tBYTE [VMODE],8\t; MOV\tWORD [SCRNX],320 MOV\tWORD [SCRNY],200 MOV\tDWORD [VRAM],0x000a0000 ; 设置键盘中断，中断号16H，自行百度 MOV\tAH,0x02 INT\t0x16 ; keyboard BIOS MOV\t[LEDS],AL ; ;\tPIC必须在CLI之前设置好 ;\t有些机型不能连续使用OUT指令，中间要停一下 ;\tPIC初始化 ; CLI指令后CPU屏蔽所有中断 MOV\tAL,0xff OUT\t0x21,AL NOP\t; OUT\t0xa1,AL CLI\t; ; 开启A20设置，这里的具体原理见下文。。 CALL\twaitkbdout MOV\tAL,0xd1 OUT\t0x64,AL CALL\twaitkbdout MOV\tAL,0xdf\t; enable A20 OUT\t0x60,AL CALL\twaitkbdout ; 这就是个简单设置并等待反馈的过程，书上说可以同时读取鼠标和键盘。。。我没看出来 [INSTRSET \"i486p\"]\t; 指令集，不知道酷睿2应该咋表示0.0 LGDT\t[GDTR0]\t; 设定GDT MOV\tEAX,CR0 AND\tEAX,0x7fffffff\t; OR\tEAX,0x00000001\t; 将EAX设置成二进制 1xxx xxxx xxxx xxxx xxxx xxxx xxxx xxx1的形式 MOV\tCR0,EAX ；CR0很高端的寄存器，只有操作系统可以使用 JMP\tpipelineflush pipelineflush: MOV\tAX,1*8\t; 1*8不知道是啥意思。。。。。 MOV\tDS,AX MOV\tES,AX MOV\tFS,AX MOV\tGS,AX MOV\tSS,AX ; bootpack MOV\tESI,bootpack\t; 复制的原始地址 MOV\tEDI,BOTPAK\t; 复制的目标地址 MOV\tECX,512*1024/4 ；DWORD是单位 CALL\tmemcpy MOV\tESI,0x7c00\t; 同上 MOV\tEDI,DSKCAC\t; 同上 MOV\tECX,512/4 CALL\tmemcpy ; 残り全部 MOV\tESI,DSKCAC0+512\t; MOV\tEDI,DSKCAC+512\t; MOV\tECX,0 MOV\tCL,BYTE [CYLS] IMUL\tECX,512*18*2/4\t; SUB\tECX,512/4\t; 真心不知道这步干啥用 CALL\tmemcpy ; bootpack开启 MOV\tEBX,BOTPAK MOV\tECX,[EBX+16] ADD\tECX,3\t; ECX += 3; SHR\tECX,2\t; ECX /= 4; JZ\tskip\t; 如果哦ECX2==0，则跳转 MOV\tESI,[EBX+20]\t; 还是复制。。 ADD\tESI,EBX MOV\tEDI,[EBX+12]\t; CALL\tmemcpy skip: MOV\tESP,[EBX+12]\t; 不懂在干啥。。。 JMP\tDWORD 2*8:0x0000001b waitkbdout: IN\tAL,0x64 AND\tAL,0x02 JNZ\twaitkbdout\t; 读入0x64的响应和0x02做与运算，非零则跳转 RET memcpy: MOV\tEAX,[ESI] ADD\tESI,4 MOV\t[EDI],EAX ADD\tEDI,4 SUB\tECX,1 JNZ\tmemcpy\t; 复制过程比较简单 RET ALIGNB\t16 GDT0: RESB\t8\t; DW\t0xffff,0x0000,0x9200,0x00cf\t; DW\t0xffff,0x0000,0x9a28,0x0047\t; 不知道在干嘛。。写了这么多奇怪的地址 DW\t0 GDTR0: DW\t8*3-1 ；依旧不知道8*3哈意思 DD\tGDT0 ALIGNB\t16 bootpack: 好吧，我的理解就只能到上面这个地步，不知道再继续往下看还能多领悟点不了。。\n为什么是向键盘发送指令来控制A20GATE呢？百度到的原因是为了控制是否使用超过1M以上的内存，并和16位兼容，IBM的老爷爷们使用键盘控制器剩下的一根信号线来控制A20，A20不是控制是否进入保护模式。\n原始16位处理器访问最高地址为0xFFFF：0xFFFF=0xFFFF0+0xFFFF=0x10EFFEF,很明显多于1M对于多出来的0xEFFEF的访问就需要另外的地址线。但是系统的做法是当程序员访问多于1M的地址时，CPU将地址按1M取模。。这样就不会超过1M了，这种技术被称为wrap-around 到了80286出现了一些问题，当程序员试图访问1M到0x10EFFEF时系统并没有循环回去而是直接访问，这导致了和之前产品不兼容，于是为了兼容，设计了第21根信号线就是上面提到的键盘控制器多余的这根，称为A20来控制是否访问1M以后的地址，当设置为打开时可以访问到多于1M的地址，关闭时则只能循环回0按8086的方式访问。 以上都是实模式下的，在保护模式下，CPU访问的内存增加，如果这个20位的控制线不被打开，那我们的第20号位地址将被视为无效，内存将会被切割成小碎片，系统将只能访问以基数兆的内存。。所以必须要打开A20才能完整访问。至于A20和键盘的关系。。。就是没啥关系，只不过用一个控制器。。。 一下内容来自互联网（没有验证准确性）：\n 多数PC都使用键盘控制器（8042芯片）来处理A20Gate。 从理论上讲，打开A20Gate的方法是通过设置8042芯片输出端口（64h）的2nd-bit，但事实上，当你向8042芯片输出端口进行写操作的时候，在键盘缓冲区中，或许还有别的数据尚未处理，因此你必须首先处理这些数据。 流程如下：   禁止中断；  等待，直到8042 Inputbuffer为空为止； 发送禁止键盘操作命令到8042Input buffer； 等待，直到8042 Inputbuffer为空为止； 发送读取8042 OutputPort命令； 等待，直到8042 Outputbuffer有数据为止； 读取8042 Outputbuffer，并保存得到的字节； 等待，直到8042 Inputbuffer为空为止； 发送Write 8042Output Port命令到8042 Input buffer；  等待，直到8042 Inputbuffer为空为止；  将从8042 OutputPort得到的字节的第2位置1（OR 2），然后写入8042 Input buffer；  等待，直到8042 Inputbuffer为空为止；  发送允许键盘操作命令到8042Input buffer；  打开中断。  今天就这样。。明天继续看。。。谢谢收看。。\n","wordCount":"367","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"谭升"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://go.face2ai.com/%E7%BC%96%E7%A8%8B/30-days/30%E5%A4%A9%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--%E7%AC%AC8%E5%A4%A9.zh/"},"publisher":{"@type":"Organization","name":"谭升的博客","logo":{"@type":"ImageObject","url":"https://go.face2ai.com/logo.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://go.face2ai.com accesskey=h title="谭升的博客 (Alt + H)">谭升的博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://go.face2ai.com/math/ title=数学><span>数学</span></a></li><li><a href=https://go.face2ai.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://go.face2ai.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://go.face2ai.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://go.face2ai.com/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://go.face2ai.com>Home</a></div><h1 class=post-title>【30天自制操作系统】 鼠标</h1><div class=post-meta>谭升</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%95%8a%e5%93%88%e9%bc%a0%e6%a0%87 aria-label=啊哈，鼠标>啊哈，鼠标</a></li></ul></div></details></div><div class=post-content><p><strong>Abstract:</strong> 《30天自制操作系统》鼠标显示
<strong>Keywords:</strong> 《30天自制操作系统》，Macbook，鼠标</p><h1 id=啊哈鼠标>啊哈，鼠标<a hidden class=anchor aria-hidden=true href=#啊哈鼠标>#</a></h1><p>今天看的有点纠结，因为竟然看困了，很少有这种情况，主要是有好多东西作者并没有做深入介绍，只是说这样是对的，至于为啥这样以后再说，这让我感觉很不爽。具体来说说。
首先，先解决了鼠标运动的问题，我感觉这个不是什么大问题，只是读取数据那需要点技巧，就是验证数据的有效性，以前用单片机发送串口数据时也用到过类似的做法，作者提出的是检查第一个字的低八位以及高两位，如果高两位是0，而低八位是8，那么数据没问题，但并不一定绝对没问题，比如发送的数据为 0x08 0x00 0x11下一组为0x08 0x08 0x01时也就是队列里面是0x08 0x00 0x11 0x08 0x08 0x01时如果红色字体丢失任意一组数据，其结果和下一组结果都是错误的，但发生的概率很小，我们也没必要要求硬件每发送一个数据都要加上校验位，那样冗余太大，也浪费资源，而且估计鼠标也不会总坏。。。
个人来讲，我不想将桌面作为系统开发的前期所应该做的（等我自己写的时候不会这么弄），一个黑漆漆的命令行而具有更强大的功能，我觉得更好，而且将桌面和系统剥离开，也就是linux那样，感觉更加自由。哈哈，这都是自己的想法，没有任何科学根据。接下来就到了让我纠结的地方了，就是作者解释了之前没解释的汇编代码：</p><pre tabindex=0><code>    ; haribote-os boot asm
    ; TAB=4

    BOTPAK	EQU		0x00280000		; c语言编写部分的入口位置
    DSKCAC	EQU		0x00100000		; 启动区将要被复制到的地方
    DSKCAC0	EQU		0x00008000		; dskcaco启动区存储地址，其实里面没啥，知识为了预留，这也是之前纠结的地方

    ; BOOT_INFO関係
    CYLS	EQU		0x0ff0			;
    LEDS	EQU		0x0ff1
    VMODE	EQU		0x0ff2			;
    SCRNX	EQU		0x0ff4			;
    SCRNY	EQU		0x0ff6			;
    VRAM	EQU		0x0ff8			;

    		ORG		0xc200			;

    ; 显示设置，中断号10H具体中断用法参照google

    MOV		AL,0x13			;
    		MOV		AH,0x00
    		INT		0x10
    		MOV		BYTE [VMODE],8	;
    		MOV		WORD [SCRNX],320
    		MOV		WORD [SCRNY],200
    		MOV		DWORD [VRAM],0x000a0000

    ; 设置键盘中断，中断号16H，自行百度

    		MOV		AH,0x02
    		INT		0x16 			; keyboard BIOS
    		MOV		[LEDS],AL

    ;
    ;	PIC必须在CLI之前设置好
    ;	有些机型不能连续使用OUT指令，中间要停一下
    ;	PIC初始化

    ; CLI指令后CPU屏蔽所有中断

    		MOV		AL,0xff
    		OUT		0x21,AL
    		NOP						;
    		OUT		0xa1,AL

    		CLI						;

    ; 开启A20设置，这里的具体原理见下文。。

    		CALL	waitkbdout
    		MOV		AL,0xd1
    		OUT		0x64,AL
    		CALL	waitkbdout
    		MOV		AL,0xdf			; enable A20
    		OUT		0x60,AL
    		CALL	waitkbdout

    ; 这就是个简单设置并等待反馈的过程，书上说可以同时读取鼠标和键盘。。。我没看出来

    [INSTRSET &#34;i486p&#34;]				; 指令集，不知道酷睿2应该咋表示0.0

    		LGDT	[GDTR0]			; 设定GDT
    		MOV		EAX,CR0
    		AND		EAX,0x7fffffff	;
    		OR		EAX,0x00000001	; 将EAX设置成二进制 1xxx xxxx xxxx xxxx xxxx xxxx xxxx xxx1的形式
    		MOV		CR0,EAX ；CR0很高端的寄存器，只有操作系统可以使用
    		JMP		pipelineflush
    pipelineflush:
    		MOV		AX,1*8			;  1*8不知道是啥意思。。。。。
    		MOV		DS,AX
    		MOV		ES,AX
    		MOV		FS,AX
    		MOV		GS,AX
    		MOV		SS,AX

    ; bootpack

    		MOV		ESI,bootpack	 ; 复制的原始地址
    		MOV		EDI,BOTPAK		; 复制的目标地址
    		MOV		ECX,512*1024/4 ；DWORD是单位
    		CALL	memcpy



    		MOV		ESI,0x7c00		; 同上
    		MOV		EDI,DSKCAC		; 同上
    		MOV		ECX,512/4
    		CALL	memcpy

    ; 残り全部

    		MOV		ESI,DSKCAC0+512	;
    		MOV		EDI,DSKCAC+512	;
    		MOV		ECX,0
    		MOV		CL,BYTE [CYLS]
    		IMUL	 ECX,512*18*2/4	;
    		SUB		ECX,512/4	; 真心不知道这步干啥用
    		CALL	memcpy


    ; bootpack开启
    		MOV		EBX,BOTPAK
    		MOV		ECX,[EBX+16]
    		ADD		ECX,3			; ECX += 3;
    		SHR		ECX,2			; ECX /= 4;
    		JZ		skip			; 如果哦ECX&gt;&gt;2==0，则跳转
    		MOV		ESI,[EBX+20]	; 还是复制。。
    		ADD		ESI,EBX
    		MOV		EDI,[EBX+12]	;
    		CALL	memcpy
    skip:
    		MOV		ESP,[EBX+12]	; 不懂在干啥。。。
    		JMP		DWORD 2*8:0x0000001b

    waitkbdout:
    		IN		 AL,0x64
    		AND		 AL,0x02
    		JNZ		waitkbdout		; 读入0x64的响应和0x02做与运算，非零则跳转

    RET

    memcpy:
    		MOV		EAX,[ESI]
    		ADD		ESI,4
    		MOV		[EDI],EAX
    		ADD		EDI,4
    		SUB		ECX,1
    		JNZ		memcpy			; 复制过程比较简单
    		RET


    		ALIGNB	16
    GDT0:
    		RESB	8				;
    		DW		0xffff,0x0000,0x9200,0x00cf	;
    		DW		0xffff,0x0000,0x9a28,0x0047	; 不知道在干嘛。。写了这么多奇怪的地址

    		DW		0
    GDTR0:
    		DW		8*3-1 ；依旧不知道8*3哈意思
    		DD		GDT0

    		ALIGNB	16
    bootpack:
</code></pre><p>好吧，我的理解就只能到上面这个地步，不知道再继续往下看还能多领悟点不了。。</p><p>为什么是向键盘发送指令来控制A20GATE呢？百度到的原因是为了控制是否使用超过1M以上的内存，并和16位兼容，IBM的老爷爷们使用键盘控制器剩下的一根信号线来控制A20，A20不是控制是否进入保护模式。</p><p>原始16位处理器访问最高地址为0xFFFF：0xFFFF=0xFFFF0+0xFFFF=0x10EFFEF,很明显多于1M对于多出来的0xEFFEF的访问就需要另外的地址线。但是系统的做法是当程序员访问多于1M的地址时，CPU将地址按1M取模。。这样就不会超过1M了，这种技术被称为wrap-around
到了80286出现了一些问题，当程序员试图访问1M到0x10EFFEF时系统并没有循环回去而是直接访问，这导致了和之前产品不兼容，于是为了兼容，设计了第21根信号线就是上面提到的键盘控制器多余的这根，称为A20来控制是否访问1M以后的地址，当设置为打开时可以访问到多于1M的地址，关闭时则只能循环回0按8086的方式访问。
以上都是实模式下的，在保护模式下，CPU访问的内存增加，如果这个20位的控制线不被打开，那我们的第20号位地址将被视为无效，内存将会被切割成小碎片，系统将只能访问以基数兆的内存。。所以必须要打开A20才能完整访问。至于A20和键盘的关系。。。就是没啥关系，只不过用一个控制器。。。
一下内容来自互联网（没有验证准确性）：</p><blockquote><p>多数PC都使用键盘控制器（8042芯片）来处理A20Gate。 从理论上讲，打开A20Gate的方法是通过设置8042芯片输出端口（64h）的2nd-bit，但事实上，当你向8042芯片输出端口进行写操作的时候，在键盘缓冲区中，或许还有别的数据尚未处理，因此你必须首先处理这些数据。 流程如下： 　</p></blockquote><ol><li>禁止中断； 　</li><li>等待，直到8042 Inputbuffer为空为止；</li><li>发送禁止键盘操作命令到8042Input buffer；</li><li>等待，直到8042 Inputbuffer为空为止；</li><li>发送读取8042 OutputPort命令；</li><li>等待，直到8042 Outputbuffer有数据为止；</li><li>读取8042 Outputbuffer，并保存得到的字节；</li><li>等待，直到8042 Inputbuffer为空为止；</li><li>发送Write 8042Output Port命令到8042 Input buffer； 　</li><li>等待，直到8042 Inputbuffer为空为止； 　</li><li>将从8042 OutputPort得到的字节的第2位置1（OR 2），然后写入8042 Input buffer； 　</li><li>等待，直到8042 Inputbuffer为空为止； 　</li><li>发送允许键盘操作命令到8042Input buffer； 　</li><li>打开中断。</li></ol><p>今天就这样。。明天继续看。。。谢谢收看。。</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://go.face2ai.com/%E7%BC%96%E7%A8%8B/30-days/30%E5%A4%A9%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--%E7%AC%AC14%E5%A4%A9.zh/><span class=title>« Prev</span><br><span>【30天自制操作系统】 高分辨率</span></a>
<a class=next href=https://go.face2ai.com/%E7%BC%96%E7%A8%8B/30-days/30%E5%A4%A9%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--mac%E4%B8%8B%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8.zh/><span class=title>Next »</span><br><span>【30天自制操作系统】Mac下工具的使用</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 【30天自制操作系统】 鼠标 on twitter" href="https://twitter.com/intent/tweet/?text=%e3%80%9030%e5%a4%a9%e8%87%aa%e5%88%b6%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e3%80%91%20%e9%bc%a0%e6%a0%87&url=https%3a%2f%2fgo.face2ai.com%2f%25E7%25BC%2596%25E7%25A8%258B%2f30-days%2f30%25E5%25A4%25A9%25E8%2587%25AA%25E5%2588%25B6%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0--%25E7%25AC%25AC8%25E5%25A4%25A9.zh%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【30天自制操作系统】 鼠标 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fgo.face2ai.com%2f%25E7%25BC%2596%25E7%25A8%258B%2f30-days%2f30%25E5%25A4%25A9%25E8%2587%25AA%25E5%2588%25B6%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0--%25E7%25AC%25AC8%25E5%25A4%25A9.zh%2f&title=%e3%80%9030%e5%a4%a9%e8%87%aa%e5%88%b6%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e3%80%91%20%e9%bc%a0%e6%a0%87&summary=%e3%80%9030%e5%a4%a9%e8%87%aa%e5%88%b6%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e3%80%91%20%e9%bc%a0%e6%a0%87&source=https%3a%2f%2fgo.face2ai.com%2f%25E7%25BC%2596%25E7%25A8%258B%2f30-days%2f30%25E5%25A4%25A9%25E8%2587%25AA%25E5%2588%25B6%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0--%25E7%25AC%25AC8%25E5%25A4%25A9.zh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【30天自制操作系统】 鼠标 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgo.face2ai.com%2f%25E7%25BC%2596%25E7%25A8%258B%2f30-days%2f30%25E5%25A4%25A9%25E8%2587%25AA%25E5%2588%25B6%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0--%25E7%25AC%25AC8%25E5%25A4%25A9.zh%2f&title=%e3%80%9030%e5%a4%a9%e8%87%aa%e5%88%b6%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e3%80%91%20%e9%bc%a0%e6%a0%87"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【30天自制操作系统】 鼠标 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgo.face2ai.com%2f%25E7%25BC%2596%25E7%25A8%258B%2f30-days%2f30%25E5%25A4%25A9%25E8%2587%25AA%25E5%2588%25B6%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0--%25E7%25AC%25AC8%25E5%25A4%25A9.zh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【30天自制操作系统】 鼠标 on whatsapp" href="https://api.whatsapp.com/send?text=%e3%80%9030%e5%a4%a9%e8%87%aa%e5%88%b6%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e3%80%91%20%e9%bc%a0%e6%a0%87%20-%20https%3a%2f%2fgo.face2ai.com%2f%25E7%25BC%2596%25E7%25A8%258B%2f30-days%2f30%25E5%25A4%25A9%25E8%2587%25AA%25E5%2588%25B6%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0--%25E7%25AC%25AC8%25E5%25A4%25A9.zh%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【30天自制操作系统】 鼠标 on telegram" href="https://telegram.me/share/url?text=%e3%80%9030%e5%a4%a9%e8%87%aa%e5%88%b6%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e3%80%91%20%e9%bc%a0%e6%a0%87&url=https%3a%2f%2fgo.face2ai.com%2f%25E7%25BC%2596%25E7%25A8%258B%2f30-days%2f30%25E5%25A4%25A9%25E8%2587%25AA%25E5%2588%25B6%25E6%2593%258D%25E4%25BD%259C%25E7%25B3%25BB%25E7%25BB%259F%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0--%25E7%25AC%25AC8%25E5%25A4%25A9.zh%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://go.face2ai.com>谭升的博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>